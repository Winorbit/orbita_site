version: '3'
services:
    webapi:
        build: ./web_api
        image: web_api
        restart: always

        ports:
            - 8010:8010
        command: gunicorn --reload -w 4  -b :8010 --env DJANGO_SETTINGS_MODULE=content.settings content.wsgi

    web-ui:
        image: web_ui
        build: ./web_ui
        restart: always
        ports:
            - 8011:8011
        links:
            - "webapi:webapi"
        command: gunicorn --reload -w 4  -b :8011 --env DJANGO_SETTINGS_MODULE=Orbit.settings Orbit.wsgi
        volumes:
            - static_volume:/home/orbita/orbit_deploy/orbita_site/web_ui
        depends_on:
            - webapi

    nginx:
        build: ./nginx
        restart: always
        links:
            - "web-ui:web-ui"
        volumes:
            - static_volume:/home/orbita/orbit_deploy/orbita_site/web_ui
        ports:
            - 1338:81
        depends_on:
        - web-ui

volumes:
  static_volume: